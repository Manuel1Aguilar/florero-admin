<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Detail</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <% if (!authenticated) { %>
    <script>
      window.location.href = '/admin';
    </script>
  <% } %>

  <h1>Order Detail</h1>
  <h2>Order ID: <%= order.id %></h2>
  <p>Client Name: <%= order.client_name %></p>
  <p>Order Code: <%= order.order_code %></p>
  <p>Color Specification: <%= order.color_spec %></p>
  <p id="order-status">Status: <%= order.status %></p>

  <% if (order.status === 'Pending') { %>
    <h2>Stock Comparison (If Confirmed)</h2>
    <table>
      <thead>
        <tr>
          <th>Color Key</th>
          <th>Current Stock</th>
          <th>Use Count</th>
          <th>Stock After Confirmation</th>
        </tr>
      </thead>
      <tbody>
        <% Object.entries(stockComparison).forEach(([cKey, { currentStock, count, updatedStock }]) => { %>
          <tr>
            <td><%= cKey %></td>
            <td><%= currentStock %></td>
            <td><%= count %></td>
            <td><%= updatedStock %></td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } else { %>
    <p>Date Closed: <%= order.date_closed %></p>
  <% } %>
<% if (order.status === 'Pending') { %>
  <button hx-post="/admin/confirm-order" hx-vals='{"order_id": "<%= order.id %>"}' hx-target="#order-status" hx-swap="outerHTML" onclick="return confirm('Are you sure you want to confirm this order?')">Confirm Order</button>
  <button hx-post="/admin/deny-order" hx-vals='{"order_id": "<%= order.id %>"}' hx-target="#order-status" hx-swap="outerHTML" onclick="return confirm('Are you sure you want to deny this order?')">Deny Order</button>
<% } %>
<button hx-post="/admin/delete-order" hx-vals='{"order_id": "<%= order.id %>"}' hx-target="body" hx-swap="innerHTML" onclick="return confirm('Are you sure you want to delete this order?')">Delete Order</button>

  <a href="/admin/manage-orders" hx-get="/admin/manage-orders" hx-target="body" hx-swap="innerHTML">Back to Orders</a>
</body>
</html>

